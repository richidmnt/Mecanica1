{% extends "./index.html" %}
{% block body %}
<section class="content">
  <div class="container-fluid">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10">
        <div class="card">
          <div class="card-body">
            <div class="row justify-content-center">
              <div class="col-lg-12">
                <div class="card card-secondary">
                  <div class="card-header">
                    <h2 class="card-title text-center">Actualizar Vehículo</h2>
                  </div>
                  <div class="card-body">
                    <form id="vehiculoForm" method="post" action="/actualizarVehiculo/">
                      {% csrf_token %}
                      <input type="hidden" name="id_veh" value="{{vehiculo.id_veh}}">
                      <div class="form-row">
                        <div class="form-group col-md-6">
                          <label for="marca_veh" class="form-label">Marca:</label>
                          <input type="text" class="form-control" id="marca_veh" name="marca_veh" value="{{ vehiculo.marca_veh }}" required />
                        </div>
                        <div class="form-group col-md-6">
                          <label for="modelo_veh" class="form-label">Modelo:</label>
                          <input type="text" class="form-control" id="modelo_veh" name="modelo_veh" value="{{ vehiculo.modelo_veh }}" required />
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-md-6">
                          <label for="placa_veh" class="form-label">Placa:</label>
                          <input type="text" class="form-control" id="placa_veh" name="placa_veh" value="{{ vehiculo.placa_veh }}" required />
                        </div>
                        <div class="form-group col-md-6">
                          <label for="anio_veh" class="form-label">Año:</label>
                          <input type="number" class="form-control" id="anio_veh" name="anio_veh" value="{{ vehiculo.anio_veh }}" required />
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-md-6">
                          <label for="chasis_veh" class="form-label">Chasis:</label>
                          <input type="text" class="form-control" id="chasis_veh" name="chasis_veh" value="{{ vehiculo.chasis_veh }}" required />
                        </div>
                        <div class="form-group col-md-6">
                          <label for="color_veh" class="form-label">Color:</label>
                          <input type="text" class="form-control" id="color_veh" name="color_veh" value="{{ vehiculo.color_veh }}" required />
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-md-12">
                          <label for="cli_id" class="form-label">Cliente:</label>
                          <select class="form-control" id="id_cli" name="cli_id" required>
                            <option value="">Seleccione un cliente</option>
                            {% for cliente in clientes %}
                              <option value="{{ cliente.id_cli }}">{{ cliente.ci_cli }}</option>
                            {% endfor %}
                          </select>
                        </div>
                        <script>
                          document.getElementById("id_cli").value="{{vehiculo.cli_id.id_cli}}";
                        </script>
                      </div>
                      <div class="d-flex justify-content-start mt-3">
                        <button type="submit" class="btn btn-primary">Actualizar Vehículo</button>
                        <a href="{% url 'listaVehiculos' %}" class="btn btn-danger ml-2">Cancelar</a>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer"></div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
{% block extra_scripts %}
<script>
  $(document).ready(function () {
    $.validator.addMethod(
    "lettersonly",
    function (value, element) {
      return this.optional(element) || /^[a-zA-Z\s]+$/i.test(value);
    },
    "Por favor, ingresa solo letras"
  );
    // Añadir método de validación para la placa ecuatoriana
    $.validator.addMethod("placaEcuador", function (value, element) {
      return this.optional(element) || /^[A-Z]{3}-\d{3,4}$|^[A-Z]{1}\d{3}-[A-Z]{2}$/.test(value);
    }, "Por favor ingrese una placa válida (ej. ABC-1234 o P123-AB)");

    // Validación del formulario utilizando jQuery Validation
    $("#vehiculoForm").validate({
      rules: {
        marca_veh: {
          required: true,
          minlength: 3,
          maxlength:30,
          lettersonly:true
        },
        modelo_veh: {
          required: true,
          minlength: 2,
          maxlength: 50
        },
        placa_veh: {
          required: true,
          placaEcuador: true,
        },
        anio_veh: {
          required: true,
          digits: true,
          minlength: 4,
          maxlength: 4,
        },
        chasis_veh: {
          required: true,
          minlength: 17,
          maxlength:17
        },
        color_veh: {
          required: true,
          minlength: 4,
          maxlength: 25,
          lettersonly:true
        },
        id_cli: {
          required: true,
        },
      },
      messages: {
        marca_veh: {
          required: "Por favor, ingresa la marca del vehículo",
          minlength: "La marca debe tener al menos 3 caracteres",
          maxlength:"La marca debe tener máximo 30 caracteres",
          lettersonly:"Por favor, ingresa solo letras"
        },
        modelo_veh: {
          required: "Por favor, ingresa el modelo del vehículo",
          minlength: "El modelo debe tener al menos 2 caracteres",
          maxlength: "El modelo debe tener máximo 50 caracteres"
        },
        placa_veh: {
          required: "Por favor, ingresa la placa del vehículo",
        },
        anio_veh: {
          required: "Por favor, ingresa el año del vehículo",
          digits: "Por favor, ingresa solo números",
          minlength: "El año debe tener 4 dígitos",
          maxlength: "El año debe tener 4 dígitos",
        },
        chasis_veh: {
          required: "Por favor, ingresa el chasis del vehículo",
          minlength: "El chasis debe tener  17 caracteres",
          maxlength:"El chasis debe tener  17 caracteres",
        },
        color_veh: {
          required: "Por favor, ingresa el color del vehículo",
          minlength: "El color debe tener al menos 3 caracteres",
          maxlength:"El color debe tener al menos 25 caracteres",
          lettersonly:"Por favor, ingresa solo letras"
        },
        id_cli: {
          required: "Por favor, selecciona un cliente",
        },
      },
      errorElement: "span",
      errorPlacement: function (error, element) {
        error.addClass("invalid-feedback");
        element.closest(".form-group").append(error);
      },
      highlight: function (element, errorClass, validClass) {
        $(element).addClass("is-invalid").removeClass("is-valid");
      },
      unhighlight: function (element, errorClass, validClass) {
        $(element).removeClass("is-invalid").addClass("is-valid");
      },
    });
  });
</script>
<script>
        $(document).ready(function () {
            // Configuración de Select2
            $("#id_cli").select2({
                allowClear: true,
                placeholder: "Seleccione el cliente"
            });
        });
</script>
{% endblock %}
